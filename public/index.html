<!DOCTYPE html>
<html lang="en">
  <head>

  <!-- //////////////////////////////////HEADER/////////////////////////////////////// -->


    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="images/favicon.ico">

    <title>PJ</title>

    <!-- Bootstrap core CSS -->
    <link href="bootstrap-3.3.6-dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="jumbotron.css" rel="stylesheet">

    <!-- Firebase configuration -->
    <script src="https://www.gstatic.com/firebasejs/3.1.0/firebase.js"></script>
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyCleCXI68tsiwMnY8-VKDKBaF3NscCc0aU",
        authDomain: "plateaujuicing.firebaseapp.com",
        databaseURL: "https://plateaujuicing.firebaseio.com",
        storageBucket: "plateaujuicing.appspot.com",
      };
      firebase.initializeApp(config);
    </script>
    
    <!-- FirebaseUI for Web Auth: Installation -->
    <script src="https://www.gstatic.com/firebasejs/ui/live/0.4/firebase-ui-auth.js"></script>
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/live/0.4/firebase-ui-auth.css" />
    <script>
            // FirebaseUI config.
      var uiConfig = {
        'signInSuccessUrl': 'http://localhost:5000/',
        'signInOptions': [
          // Leave the lines as is for the providers you want to offer your users.
          firebase.auth.GoogleAuthProvider.PROVIDER_ID,
          firebase.auth.FacebookAuthProvider.PROVIDER_ID,
          //firebase.auth.TwitterAuthProvider.PROVIDER_ID,
          //firebase.auth.GithubAuthProvider.PROVIDER_ID,
          firebase.auth.EmailAuthProvider.PROVIDER_ID
        ],
        // Terms of service url.
        'tosUrl': '<your-tos-url>',
      };

      // Initialize the FirebaseUI Widget using Firebase.
      var ui = new firebaseui.auth.AuthUI(firebase.auth());
      // The start method will wait until the DOM is loaded.
      ui.start('#firebaseui-auth-container', uiConfig);
    </script>

    <!-- FirebaseUI for Web Auth: Tracking Auth state -->
    <script type="text/javascript">
    initApp = function() {
      firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
          // User is signed in.
          var displayName = user.displayName;
          var email = user.email;
          var emailVerified = user.emailVerified;
          var photoURL = user.photoURL;
          var uid = user.uid;
          var providerData = user.providerData;
          user.getToken().then(function(accessToken) {

            //Display name in the Nav bar
            $("#user_name_navbar").text(displayName);
            $("#sign_in_out").text("Sign out");

            // Create a JSON with user account details
            var accountDetails = JSON.stringify({
              displayName: displayName,
              email: email,
              emailVerified: emailVerified,
              photoURL: photoURL,
              uid: uid,
              accessToken: accessToken,
              providerData: providerData
              }, null, '  ');
            // Push user account details to HTML content
            document.getElementById('userPhoto').src = photoURL;

            // Push user account details to Firebase
            firebase.database().ref("users/").push({
              displayName: displayName,
              email: email,
              emailVerified: emailVerified,
              photoURL: photoURL,
              uid: uid,
              accessToken: accessToken,
              providerData: providerData
              });
          }) 
        }
        else {
          // User is signed out.

        }
      }, function(error) {
        console.log(error);
      });
    };

    window.addEventListener('load', function() {
      initApp()
    });


  </script>

  <!-- jQuery -->
  <script src="node_modules/jquery/dist/jquery.js"></script>

  </head>

<!-- //////////////////////////////////BODY/////////////////////////////////////// -->

  <body>

    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Plateau Juicing</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">

          <div class="navbar-right">

            <span id="user_name_navbar" style="color: #777;">Please Sign in </span>
            
            <span style="color: #777;">( </span>
              <a id="sign_in_out" href="http://localhost:5000/" style="color: #777;" onclick="">Sign in</a>
            <span style="color: #777;"> )</span>
            
            <img id="userPhoto" src="images/default_user.png" alt="User photo" class="img-circle" style="width:40px;height:40px;margin:5px;">

          </div>

        </div><!--/.navbar-collapse -->



      </div>
    </nav>

    <!-- Main jumbotron for a primary marketing message or call to action -->
    <div class="jumbotron">
      <div class="container">
        <h1>Local, Organic Juices <br>Delivered to Your Door</h1>
        <p>Delivering amazing Juices of freshly pressed juices of veggetables and fruits.</p>
        <p><a class="btn btn-default" href="#" role="button">Learn more about us &raquo;</a></p>
      </div>
      
      <!-- Firebase UI Auth container -->
      <div id="firebaseui-auth-container"></div>


      
      <div id="sign-in-status"></div>


    </div>

    <div class="container">

      <h2>The <i>"Red Orange"</i></h2>
      <img class="juices_main_page" src="images/red_orange-original.JPG" alt="Red Orange Juice">
      <p>
        The <i>"Red Orange"</i> is a perfect mix of <i>Beet</i> and <i>Carrots</i> as main ingredients. It is sweetened by <i>Apple</i> and spiced by <i>Ginger</i>.
      </p>
      <p>
        Profile: Vitamin A, Vitamin C, ...
      </p>
    
      <form id="red_orange_ordering_form">        
        
        <div class="form-group">
          <label for="red_orange_qty">Quantity</label>
          <select class="form-control" style="width:50px" id="red_orange_qty">
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
          </select>
        </div> 

        <div class="form-group">
          <label for="red_orange_Date_Time">Delivery Date &amp Time Slot</label>
          <input type="datetime" class="form-control" style="width:350px" placeholder="E.g.: Jul 7th between 6PM and 8PM" id="red_orange_Date_Time">
        </div>  

        <div class="form-group">
          <label for="red_orange_address">Delivery Address:</label>
          <input type="text" class="form-control" style="width:350px" placeholder="E.g.: 4704 Rue de la Roche, Appartment#2" id="red_orange_address">
        </div>  

        <button type="submit" class="btn btn-primary btn-lg">Order! &raquo;</button>
      
      </form>

      <hr>

      <footer>
        <p>&copy; Plateau Juicing, Inc.</p>
      </footer>

    </div> <!-- /container -->

<!-- //////////////////////////////////SCRIPTS/////////////////////////////////////// -->

  <!-- Facebook SDK for Javascript -->
  <script>
    window.fbAsyncInit = function() {
      FB.init({
        appId      : '651800564970614',
        xfbml      : true,
        version    : 'v2.6'
      });
    };

    (function(d, s, id){
       var js, fjs = d.getElementsByTagName(s)[0];
       if (d.getElementById(id)) {return;}
       js = d.createElement(s); js.id = id;
       js.src = "//connect.facebook.net/en_US/sdk.js";
       fjs.parentNode.insertBefore(js, fjs);
     }(document, 'script', 'facebook-jssdk'));
  </script>

  <!-- Old fields e-mail / password 
  <script>
    var email_input = document.getElementById("email");
    var signin_button = document.getElementById("signin_button");
    
    signin_button.addEventListener("click", function() {

      console.log(email_input.value); 

      firebase.database().ref("users/").push({
        email: email_input.value
      });

    });
  </script>
  -->

  <!-- Ordering NEW -->
  <script>
    var firebaseOrders = firebase.database().ref().child("orders");

    var submitOrder = function() {

      console.log("submit order function called!");

      var qty = $("#red_orange_qty").val();
      var dateTime = $("#red_orange_Date_Time").val();
      var address = $("#red_orange_address").val();

      console.log("Red Orange ordered!");
      console.log("Qty:" + qty);
      console.log("Date and Time:" + dateTime);
      console.log("Delivery Address:" + address);

      firebaseOrders.push({
        "newMethod": true,
        "qty": qty,
        "date_time": dateTime,
        "delivery_address": address,
        "juice_id": "Red Orange",
        "userUid": firebase.auth().currentUser.uid,
        "userDisplayName": firebase.auth().currentUser.displayName       
      });

    }

    //jQuery: listening event window loaded
    $(window).on("load", function() {

      console.log("Window loaded!");

      //jQuery listening for Form submittal
      $("#red_orange_ordering_form").on("submit", function() {
        console.log("Order Form submitted!");
        submitOrder();
        //returning false to prevent the event to bubble and trigger further actions...
        return false;
      });

      

    });

  </script>


  </body>
</html>
